"use strict";function e(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var t=e(require("visitor-as/as"));const{CommonFlags:n,NodeKind:r}=t;function i(e){return e.internalName.startsWith("~")}function s(e,t){return 0!=(e.flags&t)}function a(e){var t;return(null===(t=e.getClass())||void 0===t?void 0:t.internalName)??e.toString()}function o(e){let t=e.parent;for(;t!==t.parent;)t=t.parent;return t}function c(e){return{returnType:a(e.signature.returnType),parameters:e.signature.parameterTypes.map((e=>a(e)))}}function u(e){var t;const n={},r=null===(t=e.getClass)||void 0===t?void 0:t.call(e);if(!r)return n;if(n[r.internalName]={id:r.id,byteSize:r.nextMemoryOffset},r.typeArguments)for(const e of r.typeArguments)Object.assign(n,u(e));return n}function f(e){const t={};return Object.assign(t,u(e.signature.returnType)),e.signature.parameterTypes.forEach((e=>Object.assign(t,u(e)))),t}module.exports=class{afterCompile(e){const t=[...this.program.elementsByDeclaration.values()].filter((e=>s(e,n.MODULE_EXPORT))).filter((e=>!i(e))).filter((e=>e.declaration.kind===r.FUNCTIONDECLARATION)),a=[...this.program.elementsByDeclaration.values()].filter((e=>s(e,n.DECLARE))).filter((e=>!i(e))).filter((e=>e.declaration.kind===r.FUNCTIONDECLARATION)),u={},l={};for(let e of a){if(!e.instances)continue;if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");e=e.instances.get("");const t=o(e).internalName.split("/").slice(-1)[0];l.hasOwnProperty(t)||(l[t]={}),l[t][e.name]=c(e),Object.assign(u,f(e))}const p={};for(let e of t){if(e.instances.size>1||!e.instances.has(""))throw Error("Can’t import or export generic functions.");e=e.instances.get(""),p[e.name]=c(e),Object.assign(u,f(e))}this.typeData=JSON.stringify({typeIds:u,importedFunctions:l,exportedFunctions:p}),e.addCustomSection("as-bind_bindings",new TextEncoder("utf8").encode(this.typeData))}};
